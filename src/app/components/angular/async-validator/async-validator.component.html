<div>
  <h1 style="font-size: 3rem;">Async Validator trong Angular Form</h1>
  <br>
  <p>Trong day 36, chÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu vá» validate reactive forms trong Angular, cÅ©ng nhÆ° viáº¿t má»™t custom validator Ä‘Æ¡n
    giáº£n Ä‘á»ƒ check xem input cÃ³ dáº¥u cÃ¡ch hay ko.</p>
  <p>Day 37 nÃ y sáº½ nÃ³ thÃªm vá» Async Validator trong Angular.</p>
  <br>

  <!-- Prerequisites -->
  <span style="font-size: 2rem;" class="pb-0">Prerequisites</span>
  <div class="border-b1"></div>
  <br>
  <p>Vi dá»¥ hÃ´m nay sáº½ hÆ¡i khÃ¡c vÃ­ dá»¥ tá»« cÃ¡c bÃ i trÆ°á»›c, tuy váº«n cÃ³ Ä‘Ã´i chÃºt quen thuá»™c.
  </p>
  <p>MÃ¬nh sáº½ build má»™t form Ä‘Äƒng kÃ­ user - registerForm bao gá»“m:</p>
  <p>1. Username textbox</p>
  <ul>
    <li>KhÃ´ng Ä‘Æ°á»£c bá» trá»‘ng, cÃ³ Ä‘á»™ dÃ i tá»« 6 Ä‘áº¿n 32 kÃ½ tá»±, chá»‰ chá»©a kÃ½ tá»± alphabet.</li>
    <li>Giáº£ sá»­ nhÆ° cÃ³ username: trungvo, tieppt, chautran Ä‘Ã£ tá»“n táº¡i trong há»‡ thá»‘ng. Khi ngÆ°á»i dÃ¹ng nháº­p má»™t trong ba
      user ká»ƒ trÃªn thÃ¬ sáº½ ko cho phÃ©p Ä‘Äƒng kÃ­.</li>
  </ul>
  <p>2. Password textbox
  </p>
  <ul>
    <li>KhÃ´ng Ä‘Æ°á»£c bá» trá»‘ng, cÃ³ Ä‘á»™ dÃ i tá»« 6 Ä‘áº¿n 32 kÃ½ tá»±, chá»‰ chÆ°a cÃ¡c kÃ½ tá»± alphabet, digit, vÃ  pháº£i chá»©a Ã­t nháº¥t má»™t
      kÃ½ tá»± Ä‘áº·c biá»‡t trong list: !@#\$%^&\*</li>
  </ul>
  <p>3. Retype password</p>
  <ul>
    <li>CÃ¹ng yÃªu cáº§u nhÆ° password ká»ƒ trÃªn.</li>
    <li>Äá»ƒ Ä‘áº£m báº£o cháº¯c cháº¯n user nháº­p Ä‘Ãºng password. GiÃ¡ trá»‹ cá»§a textbox nÃ y pháº£i giá»‘ng há»‡t giÃ¡ trá»‹ textbox password á»Ÿ
      trÃªn.</li>
  </ul>
  <p>MÃ¬nh sáº½ setup form nhÆ° á»Ÿ dÆ°á»›i nhÃ©.</p>
  <br>
  <pre>
      <code>{{text1}}</code>
  </pre>
  <p>Pháº§n HTML cá»§a form sáº½ cÃ³ dáº¡ng nhÆ° sau.</p>
  <pre>
    <code>{{text2}}</code>
</pre>
  <br>

  <!--Custom Validators-->
  <span style="font-size: 2rem;" class="pb-0">Custom Validators</span>
  <div class="border-b1"></div>
  <br>
  <p>Dá»±a vÃ o requirements, ta cáº§n viáº¿t 2 custom validator:</p>
  <p>1. Async validator Ä‘á»ƒ gá»i API check xem username Ä‘Ã£ tá»“n táº¡i trong há»‡ thá»‘ng hay chÆ°a</p>
  <p>2. Sync validator Ä‘á»ƒ check xem password type láº§n hai cÃ³ trÃ¹ng khá»›p vá»›i password Ä‘áº§u tiÃªn hay ko.</p>
  <br>

  <!--1. Async Validator Ä‘á»ƒ validate username-->
  <span style="font-size: 2rem;" class="pb-0">1. Async Validator Ä‘á»ƒ validate username</span>
  <div class="border-b1"></div>
  <br>
  <p>Äá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c Reactive Forms á»Ÿ trong á»©ng dá»¥ng, chÃºng ta cáº§n imports má»™t NgModule lÃ  ReactiveFormsModule vÃ o
    NgModule quáº£n lÃ½ component cá»§a chÃºng ta - trong trÆ°á»ng há»£p cá»§a component hiá»‡n táº¡i lÃ  AppModule.</p>
  <p>Nháº¯c láº¡i má»™t chÃºt vá» Async Validator. ÄÃ¢y lÃ  cÃ¡c validate function sáº½ tráº£ vá» Promise hoáº·c Observable. VÃ­ dá»¥ nhÆ° báº¡n
    muá»‘n validate xem username nháº­p vÃ o Ä‘Ã£ cÃ³ trong há»‡ thá»‘ng hay chÆ°a. ThÃ´ng thÆ°á»ng báº¯t buá»™c báº¡n pháº£i gá»­i má»™t yÃªu cáº§u
    lÃªn server Ä‘á»ƒ lÃ m viá»‡c nÃ y, HTTP request thÆ°á»ng sáº½ tráº£ vá» Promise/Observable.</p>
  <p>VÃ¬ ko cÃ³ API nÃªn mÃ¬nh sáº½ mock má»™t hÃ m Ä‘á»ƒ check username vÃ  sáº½ tráº£ vá» false náº¿u nhÆ° input lÃ  má»™t trong 3 giÃ¡ trá»‹:
    trungvo, tieppt, chautran, náº¿u ko sáº½ tráº£ láº¡i true. Má»—i khi validateUsername dc gá»i mÃ¬nh cÅ©ng sáº½ in ra console má»™t
    dÃ²ng text Trigger API call Ä‘á»ƒ tiá»‡n cho viá»‡c demo á»Ÿ dÆ°á»›i.</p>
  <pre>
      <code>{{text3}}</code>
    </pre>
  <p>Giá» mÃ¬nh sáº½ tiáº¿n hÃ nh viáº¿t custom async validator Ä‘á»ƒ validate username trÃ¹ng khá»›p. Äá»ƒ viáº¿t Ä‘c má»™t async validator,
    cÃ¡c báº¡n cÃ³ hai lá»±a chá»n:</p>
  <ul>
    <li>Viáº¿t má»™t function, nháº­n vÃ o lÃ  má»™t AbstractControl vÃ  output tráº£ vá» dáº¡ng Promise ValidationErrors | null> |
      Observable ValidationErrors | null>. Cáº£ function sáº½ cÃ³ signature dáº¡ng validate(control: AbstractControl):
      Promise ValidationErrors | null> | Observable ValidationErrors | null>.</li>
    <li>Implement interface AsyncValidator, trong Ä‘Ã³ cÃ³ Ä‘á»‹nh nghÄ©a sáºµn lÃ  báº¡n pháº£i implement function validate.</li>
  </ul>
  <strong>validateUserNameFromAPI</strong>
  <p>MÃ¬nh sáº½ lÃ m theo cÃ¡ch thá»© nháº¥t. Náº¿u lÃ m theo cÃ¡ch thá»© hai pháº£i truyá»n thÃªm má»™t sá»‘ thÃ´ng tin nhÆ° API service vÃ o
    contructor khi khá»Ÿi táº¡o async validator.</p>
  <ul>
    <li>Náº¿u API tráº£ vá» lÃ  true, thÃ¬ hÃ m validateUserNameFromAPI sáº½ tráº£ vá» null, tá»©c lÃ  input nÃ y hoÃ n toÃ n ko cÃ³ lá»—i gÃ¬.
    </li>
    <li>CÃ²n náº¿u API tráº£ vá» false, thÃ¬ hÃ m validateUserNameFromAPI sáº½ tráº£ vá» má»™t object vá»›i data lÃ  báº¥t cá»© gÃ¬ báº¡n muá»‘n,
      nhÆ°ng thÃ´ng tin nÃªn cÃ³ giÃ¡ trá»‹ má»™t chÃºt Ä‘á»ƒ sau nÃ y cÃ²n dÃ¹ng hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i cho user cháº³ng háº¡n</li>
  </ul>
  <br>
  <pre>
    <code>{{text4}}</code>
</pre>
  <p>Sau khi viáº¿t xong function, chÃºng ta cáº§n config control Ä‘á»ƒ sá»­ dá»¥ng validator Ä‘Ã³.</p>
  <pre>
    <code>{{text5}}</code>
</pre>
  <p>Táº¡i sao pháº£i cÃ³ bind(this) thÃ¬ Ä‘Ã¢y lÃ  má»™t chá»§ Ä‘á» khÃ¡ dÃ i dÃ²ng ğŸ˜‚ MÃ¬nh sáº½ giáº£i thÃ­ch sau nhÃ©.</p>
  <p>Káº¿t quáº£ nhÆ° hÃ¬nh dÆ°á»›i. Khi Ä‘iá»n Ä‘á»§ 6 kÃ­ tá»± alpha, khi Ä‘Ã³ username Ä‘Ã£ pass toÃ n bá»™ sync validator thÃ¬ async
    validator sáº½ Ä‘c trigger ngay sau khi báº¡n Ä‘iá»n kÃ­ tá»± thá»© 6. Sau Ä‘Ã³, má»—i kÃ­ tá»± khi Ä‘Æ°á»£c nháº­p tá»« bÃ n phÃ­m vÃ o sáº½
    trigger má»™t API lÃªn server Ä‘á»ƒ validate, nhÆ° ta Ä‘Ã£ tháº¥y cÃ³ console.log "Trigger API call".</p>
  <strong>validateUserNameFromAPIDebounce</strong>
  <p>Báº¡n cÃ³ tháº¥y screenshot cÃ³ Ä‘iá»ƒm nÃ o quen quen ko? Use case khi Ä‘iá»n vÃ o searchbox ko trigger API call ngay láº­p tá»©c
    mÃ  chá»‰ call API náº¿u nhÆ° giá»¯a hai keystroke cÃ¡ch nhau má»™t khoáº£ng thá»i gian, thÆ°á»ng lÃ  300ms. ChÃºng ta cÅ©ng cÃ³ thá»ƒ
    implement behavior Ä‘Ã³ tÆ°Æ¡ng tá»± nhÆ° dÃ¹ng async validator. Sá»­a Ä‘oáº¡n code á»Ÿ trÃªn cÃ³ dÃ¹ng timer nhÆ° á»Ÿ dÆ°á»›i:</p>
  <pre>
      <code>{{text6}}</code>
      </pre>
  <p>Sau Ä‘Ã³ config control Ä‘á»ƒ dÃ¹ng validateUserNameFromAPIDebounce.</p>
  <pre>
    <code>{{text7}}</code>
    </pre>
  <p>Káº¿t quáº£ Ä‘Ã¢y, sau khi Ä‘Ã£ type chautr Ä‘á»§ 6 kÃ­ tá»±. MÃ¬nh sáº½ type ba lÄƒng nhÄƒng vÃ  sau khi dá»«ng ko type ná»¯a thÃ¬ API sáº½
    Ä‘Æ°á»£c trigger sau 300ms, chá»© ko pháº£i sau má»—i keystroke.
  </p>
  <br>

  <!--ChÃº Ã½!-->
  <span style="font-size: 2rem;" class="pb-0">ChÃº Ã½!</span>
  <div class="border-b1"></div>
  <br>
  <p>á» form Register, sau khi mÃ¬nh Ä‘Ã£ Ä‘iá»n Ä‘Ãºng hai password vÃ  giá» mÃ¬nh má»›i Ä‘iá»n username. Trong khoáº£ng thá»i gian delay
    1 giÃ¢y khi async validator Ä‘ang Ä‘á»£i káº¿t quáº£ kiá»ƒm tráº£ tá»« API thÃ¬ nÃºt Register Ä‘Ã£ Ä‘Æ°á»£c enable trá»Ÿ láº¡i. Náº¿u user nhanh
    tay báº¥m Register thÃ¬ ngSubmit váº«n dc trigger vÃ  báº¡n váº«n sáº½ thá»±c hiá»‡n pháº§n pháº§n code cho submit form. Sau 1 giÃ¢y sau
    khi Ä‘Ã£ validate xong, náº¿u username bá»‹ trÃ¹ng láº·p thÃ¬ nÃºt Register má»›i láº¡i Ä‘c vÃ´ hiá»‡u hÃ³a.</p>
  <br>
  <p>Äá»ƒ chá»©ng minh thÃ¬ mÃ¬nh sáº½ add thÃªm hÃ m onSubmit:</p>
  <pre>
      <code>{{text8}}</code>
  </pre>
  <p>CÃ³ thá»ƒ tháº¥y lÃ  mÃ¬nh váº«n báº¥m Ä‘Æ°á»£c nÃºt Register trong khi Ä‘ang validate username ğŸ˜‚ Äá»ƒ fix lá»—i nÃ y thÃ¬ mÃ¬nh cÃ³ tham
    kháº£o má»™t cÃ¢u tráº£ lá»i trÃªn stackoveflow.</p>
  <p>Ã tÆ°á»Ÿng lÃ  thay vÃ¬ ngSubmit sáº½ trigger tháº³ng hÃ m submit, thay vÃ o Ä‘Ã³ mÃ¬nh sáº½ táº¡o ra má»™t Subject tÃªn lÃ  formSubmit$
    vÃ  handle chá»‰ khi nÃ o status cá»§a form chuyá»ƒn thÃ nh VALID thÃ¬ formSubmit$ má»›i emit má»™t value, tá»« Ä‘Ã³ má»›i call hÃ m
    submitForm.</p>
  <pre>
      <code>{{text8}}</code>
  </pre>
  <pre>
    <code>{{text9}}</code>
  </pre>
  <p>Test thÃ´i anh em. NhÆ° trong hÃ¬nh thÃ¬ trong khoáº£ng thá»i gian Ä‘ang validate mÃ  nÃºt Register Ä‘c enable thÃ¬ cÃ³ báº¥m nÃºt
    cÅ©ng sáº½ ko trigger hÃ m submitForm vÃ  ko cÃ³ console hiá»‡n ra.</p>
  <strong>2. Bonus: Validate confirm password</strong>
  <p>Use case Ä‘á»ƒ validate confirm password trÃ¹ng vá»›i password thÃ¬ chÃºng ta chá»‰ cáº§n viáº¿t má»™t hÃ m custom validator Ä‘Æ¡n
    giáº£n hÆ¡n, nhÆ°ng hÃ m nÃ y vÃ¬ cáº§n value cá»§a 2 controls nÃªn mÃ¬nh sáº½ apply validator nÃ y cho formGroup nhÃ©. Code cá»§a
    function validateControlsValue sáº½ nhÆ° sau:</p>
  <pre>
      <code>{{text10}}</code>
  </pre>
  <ul>
    <li>MÃ¬nh táº¡o ra hÃ m validateControlsValue vÃ  truyá»n vÃ o tÃªn cá»§a 2 controls. Function nÃ y sáº½ return láº¡i má»™t function
      lÃ m nhiá»‡m vá»¥ validate.</li>
    <li>Function validate sáº½ nháº­n vÃ o má»™t formGroup vÃ  get value tá»« hai control.</li>
    <li>Náº¿u hai control nÃ y cÃ³ giÃ¡ trá»‹ giá»‘ng nhau thÃ¬ return null, tá»©c lÃ  ko cÃ³ lá»—i. Náº¿u ko sáº½ return má»™t object thÃ´ng
      bÃ¡o lá»—i Ä‘á»ƒ dá»±a vÃ o Ä‘Ã³ ta cÃ³ thá»ƒ hiá»ƒn thá»‹ lÃªn UI.</li>
  </ul>
  <p>Sau Ä‘Ã³ mÃ¬nh apply validator nÃ y vÃ o form group.</p>
  <pre>
    <code>{{text11}}</code>
</pre>
  <br>
</div>